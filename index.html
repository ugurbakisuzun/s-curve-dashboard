<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S-Curve Dashboard - Deployment Ready</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/recharts/2.8.0/Recharts.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for better deployment compatibility */
        .dashboard-container {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 1.5rem;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }
        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
        }
        .activity-button {
            padding: 0.75rem;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
            background: white;
            color: #374151;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            font-size: 0.875rem;
        }
        .activity-button.selected {
            border-color: #3b82f6;
            background: #eff6ff;
            color: #1d4ed8;
        }
        .activity-button:hover {
            border-color: #9ca3af;
        }
        .file-upload {
            width: 100%;
            padding: 0.75rem;
            border: 2px dashed #d1d5db;
            border-radius: 0.5rem;
            transition: border-color 0.3s ease;
        }
        .file-upload:hover {
            border-color: #60a5fa;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .stat-card {
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            padding: 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        .activity-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 0.75rem;
            margin: 1.5rem 0;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script>
        // S-Curve Dashboard Component (React)
        const { useState, useEffect, useRef } = React;
        const { LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer, ComposedChart, Bar } = Recharts;

        const SCurveDashboard = () => {
            const [chartData, setChartData] = useState([]);
            const [activityData, setActivityData] = useState([]);
            const [selectedActivities, setSelectedActivities] = useState([]);
            const [isUsingUploadedData, setIsUsingUploadedData] = useState(false);
            const [fileName, setFileName] = useState('');
            const [loading, setLoading] = useState(false);
            const fileInputRef = useRef(null);

            // Sample CSV data
            const csvData = `Activity ID,Activity Name,Start,Finish,Original Duration,Spreadsheet Field,01-Aug-22,01-Sep-22,01-Oct-22,01-Nov-22,01-Dec-22,01-Jan-23,01-Feb-23,01-Mar-23,01-Apr-23,01-May-23,01-Jun-23,01-Jul-23,01-Aug-23,01-Sep-23,01-Oct-23,01-Nov-23,01-Dec-23,01-Jan-24,01-Feb-24,01-Mar-24,01-Apr-24,01-May-24,01-Jun-24,01-Jul-24,01-Aug-24,01-Sep-24,01-Oct-24,01-Nov-24,01-Dec-24,01-Jan-25,01-Feb-25,01-Mar-25
MEP Labour,,10-Nov-23,19-Feb-25,309d,Budgeted Labor Units,,,,,,,,,,,,,,,,2162,2498,6049,11138,30055,65602,74576,103401,114529,94676,84343,58010,25818,9226,5189,1874,
J Coffey Labour,,09-Jan-23,05-Sep-24,414d,Budgeted Labor Units,,,,,,5137,8236,7012,11742,18592,23239,20630,27643,24544,21201,26175,10356,12313,13128,8072,3669,1386,1631,2854,4159,326,,,,,,
Severefield Labour,,21-Aug-23,06-Nov-24,302d,Budgeted Labor Units,,,,,,,,,,,,,256,1024,1504,2592,4352,5472,5504,5824,8544,8384,10176,7552,3328,1056,1376,256,,,,
Commercial Manager,,16-Aug-22 A,05-Sep-24,507d,Budgeted Labor Units,144,408,1792,3872,3232,3352,3576,4064,2616,2264,1464,624,456,336,352,544,672,816,864,464,744,544,456,392,168,32,,,,,,
Concrete Slab Labour,,23-Nov-23,23-Sep-24,203d,Budgeted Labor Units,,,,,,,,,,,,,,,,672,800,3008,5888,3872,3104,4576,5216,3408,3984,1312,,,,,,
Ceiling Labour,,14-Mar-24,05-Nov-24,164d,Budgeted Labor Units,,,,,,,,,,,,,,,,,,,,576,384,1728,1872,1872,1344,1968,816,144,,,,`;

            const parseData = (csvContent = null) => {
                const dataToUse = csvContent || csvData;
                const lines = dataToUse.trim().split('\n');
                const headers = lines[0].split(',');
                
                let dateStartIndex = 6;
                for (let i = 0; i < headers.length; i++) {
                    if (headers[i].match(/\d{2}-\w{3}-\d{2}/) || headers[i].includes('Aug') || headers[i].includes('Jan')) {
                        dateStartIndex = i;
                        break;
                    }
                }
                
                const timeColumns = headers.slice(dateStartIndex);
                const activities = [];
                const chartDataMap = {};

                timeColumns.forEach(month => {
                    chartDataMap[month] = { month, totalMonthly: 0, totalCumulative: 0 };
                });

                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',');
                    const activityId = values[0]?.trim();
                    const activityName = values[1]?.trim();
                    
                    if (!activityId || activityId === '') continue;

                    const monthlyValues = [];
                    const cumulativeValues = [];
                    let cumulative = 0;

                    for (let j = dateStartIndex; j < values.length && j < headers.length; j++) {
                        const value = parseFloat(values[j]?.replace(/"/g, '')) || 0;
                        monthlyValues.push(value);
                        cumulative += value;
                        cumulativeValues.push(cumulative);

                        const monthIndex = j - dateStartIndex;
                        const month = timeColumns[monthIndex];
                        if (chartDataMap[month]) {
                            chartDataMap[month].totalMonthly += value;
                            chartDataMap[month][`${activityId}_monthly`] = value;
                            chartDataMap[month][`${activityId}_cumulative`] = cumulative;
                        }
                    }

                    if (cumulative > 0) {
                        activities.push({
                            id: activityId,
                            name: activityName || activityId,
                            monthlyValues,
                            cumulativeValues,
                            total: cumulative,
                            color: `hsl(${(i * 137.5) % 360}, 70%, 50%)`
                        });
                    }
                }

                let runningTotal = 0;
                Object.keys(chartDataMap).forEach(month => {
                    runningTotal += chartDataMap[month].totalMonthly;
                    chartDataMap[month].totalCumulative = runningTotal;
                });

                const chartDataArray = Object.values(chartDataMap).filter(item => item.month);
                setChartData(chartDataArray);
                setActivityData(activities.sort((a, b) => b.total - a.total));
                setSelectedActivities(activities.slice(0, 5).map(a => a.id));
            };

            const handleFileUpload = async (event) => {
                const file = event.target.files[0];
                if (!file) return;

                setLoading(true);
                setFileName(file.name);

                try {
                    if (file.name.toLowerCase().endsWith('.csv')) {
                        const text = await file.text();
                        parseData(text);
                        setIsUsingUploadedData(true);
                    } else if (file.name.toLowerCase().endsWith('.xlsx') || file.name.toLowerCase().endsWith('.xls')) {
                        const arrayBuffer = await file.arrayBuffer();
                        const workbook = XLSX.read(arrayBuffer, { type: 'array' });
                        const firstSheetName = workbook.SheetNames[0];
                        const worksheet = workbook.Sheets[firstSheetName];
                        const csvContent = XLSX.utils.sheet_to_csv(worksheet);
                        parseData(csvContent);
                        setIsUsingUploadedData(true);
                    }
                } catch (error) {
                    alert('Error reading file. Please ensure it follows the same format as the sample data.');
                    console.error('File parsing error:', error);
                } finally {
                    setLoading(false);
                }
            };

            const resetToSampleData = () => {
                setIsUsingUploadedData(false);
                setFileName('');
                parseData();
                if (fileInputRef.current) {
                    fileInputRef.current.value = '';
                }
            };

            const exportToPDF = () => {
                window.print();
            };

            const formatNumber = (value) => {
                if (value >= 1000000) return (value / 1000000).toFixed(1) + 'M';
                if (value >= 1000) return (value / 1000).toFixed(1) + 'K';
                return value.toString();
            };

            const toggleActivity = (activityId) => {
                setSelectedActivities(prev => 
                    prev.includes(activityId) 
                        ? prev.filter(id => id !== activityId)
                        : [...prev, activityId]
                );
            };

            useEffect(() => {
                parseData();
            }, []);

            return React.createElement('div', { className: 'dashboard-container' },
                React.createElement('div', { className: 'max-w-7xl mx-auto' },
                    // Header
                    React.createElement('div', { className: 'card' },
                        React.createElement('div', { className: 'flex items-center justify-between flex-wrap gap-4' },
                            React.createElement('div', null,
                                React.createElement('h1', { className: 'text-3xl font-bold text-gray-800' }, 
                                    'ðŸ“Š S-Curve Visual Dashboard'),
                                React.createElement('p', { className: 'text-gray-600 mt-2' },
                                    isUsingUploadedData 
                                        ? `Analyzing: ${fileName}` 
                                        : 'Interactive S-curve visualization - upload your data or use sample data'
                                )
                            ),
                            React.createElement('div', { className: 'flex gap-3' },
                                React.createElement('button', { 
                                    onClick: exportToPDF,
                                    className: 'btn-primary'
                                }, 'ðŸ“„ Print/PDF'),
                                React.createElement('button', { 
                                    onClick: () => alert('Download Excel template feature - integrate with your Excel workflow'),
                                    className: 'btn-primary'
                                }, 'ðŸ“Š Excel Template')
                            )
                        )
                    ),

                    // File Upload
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { className: 'text-xl font-bold text-gray-800 mb-4' }, 
                            'ðŸ“¤ Upload Your Data'),
                        React.createElement('div', { className: 'flex items-center gap-4' },
                            React.createElement('div', { className: 'flex-1' },
                                React.createElement('input', {
                                    ref: fileInputRef,
                                    type: 'file',
                                    accept: '.csv,.xlsx,.xls',
                                    onChange: handleFileUpload,
                                    className: 'file-upload',
                                    disabled: loading
                                }),
                                React.createElement('p', { className: 'text-sm text-gray-500 mt-2' },
                                    'Upload CSV or Excel files with the same format: Activity ID, Activity Name, then monthly columns'
                                )
                            ),
                            isUsingUploadedData && React.createElement('button', {
                                onClick: resetToSampleData,
                                className: 'btn-primary'
                            }, 'ðŸ”„ Reset to Sample')
                        ),
                        loading && React.createElement('div', { className: 'mt-4 p-3 bg-blue-50 border border-blue-200 rounded-lg' },
                            React.createElement('div', { className: 'flex items-center gap-2' },
                                React.createElement('span', { className: 'text-blue-700' }, 'ðŸ”„ Processing file...')
                            )
                        )
                    ),

                    // Summary Stats
                    React.createElement('div', { className: 'stats-grid' },
                        React.createElement('div', { className: 'stat-card' },
                            React.createElement('div', null,
                                React.createElement('p', { className: 'text-sm text-gray-600' }, 'Total Activities'),
                                React.createElement('p', { className: 'text-2xl font-bold text-gray-800' }, activityData.length)
                            )
                        ),
                        React.createElement('div', { className: 'stat-card' },
                            React.createElement('div', null,
                                React.createElement('p', { className: 'text-sm text-gray-600' }, 'Total Resources'),
                                React.createElement('p', { className: 'text-2xl font-bold text-gray-800' },
                                    formatNumber(activityData.reduce((sum, activity) => sum + activity.total, 0))
                                )
                            )
                        ),
                        React.createElement('div', { className: 'stat-card' },
                            React.createElement('div', null,
                                React.createElement('p', { className: 'text-sm text-gray-600' }, 'Time Period'),
                                React.createElement('p', { className: 'text-lg font-bold text-gray-800' }, `${chartData.length} Months`)
                            )
                        ),
                        React.createElement('div', { className: 'stat-card' },
                            React.createElement('div', null,
                                React.createElement('p', { className: 'text-sm text-gray-600' }, 'Peak Month'),
                                React.createElement('p', { className: 'text-lg font-bold text-gray-800' },
                                    chartData.reduce((max, current) => 
                                        current.totalMonthly > max.totalMonthly ? current : max, 
                                        chartData[0] || {}
                                    )?.month?.split('-')[1] || 'N/A'
                                )
                            )
                        )
                    ),

                    // Main Chart
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { className: 'text-2xl font-bold text-gray-800 mb-4' }, 
                            'Overall Project S-Curve'),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            'Monthly resource distribution (bars) with cumulative S-curve progression (line)'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 400 },
                            React.createElement(ComposedChart, { data: chartData },
                                React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                                React.createElement(XAxis, { 
                                    dataKey: 'month',
                                    angle: -45,
                                    textAnchor: 'end',
                                    height: 80,
                                    fontSize: 11
                                }),
                                React.createElement(YAxis, { yAxisId: 'monthly', orientation: 'left' }),
                                React.createElement(YAxis, { yAxisId: 'cumulative', orientation: 'right' }),
                                React.createElement(Tooltip),
                                React.createElement(Legend),
                                React.createElement(Bar, {
                                    yAxisId: 'monthly',
                                    dataKey: 'totalMonthly',
                                    fill: '#3B82F6',
                                    name: 'Monthly Resources',
                                    opacity: 0.7
                                }),
                                React.createElement(Line, {
                                    yAxisId: 'cumulative',
                                    type: 'monotone',
                                    dataKey: 'totalCumulative',
                                    stroke: '#EF4444',
                                    strokeWidth: 3,
                                    name: 'Cumulative S-Curve'
                                })
                            )
                        )
                    ),

                    // Activity Selection
                    React.createElement('div', { className: 'card' },
                        React.createElement('h3', { className: 'text-xl font-bold text-gray-800 mb-4' },
                            'Select Activities for Individual S-Curves'),
                        React.createElement('div', { className: 'activity-grid' },
                            activityData.map(activity =>
                                React.createElement('button', {
                                    key: activity.id,
                                    onClick: () => toggleActivity(activity.id),
                                    className: `activity-button ${selectedActivities.includes(activity.id) ? 'selected' : ''}`
                                },
                                    React.createElement('div', { className: 'font-medium' }, activity.id),
                                    React.createElement('div', { className: 'text-xs opacity-75' }, formatNumber(activity.total))
                                )
                            )
                        )
                    ),

                    // Individual Activities Chart
                    React.createElement('div', { className: 'card' },
                        React.createElement('h2', { className: 'text-2xl font-bold text-gray-800 mb-4' },
                            'Individual Activity S-Curves'),
                        React.createElement('p', { className: 'text-gray-600 mb-4' },
                            'Monthly distribution and cumulative S-curves for selected activities'),
                        React.createElement(ResponsiveContainer, { width: '100%', height: 500 },
                            React.createElement(ComposedChart, { data: chartData },
                                React.createElement(CartesianGrid, { strokeDasharray: '3 3' }),
                                React.createElement(XAxis, { 
                                    dataKey: 'month',
                                    angle: -45,
                                    textAnchor: 'end',
                                    height: 80,
                                    fontSize: 11
                                }),
                                React.createElement(YAxis, { yAxisId: 'monthly', orientation: 'left' }),
                                React.createElement(YAxis, { yAxisId: 'cumulative', orientation: 'right' }),
                                React.createElement(Tooltip),
                                React.createElement(Legend),
                                ...selectedActivities.map((activityId, index) => {
                                    const activity = activityData.find(a => a.id === activityId);
                                    if (!activity) return null;
                                    
                                    return [
                                        React.createElement(Bar, {
                                            key: `bar-${activityId}`,
                                            yAxisId: 'monthly',
                                            dataKey: `${activityId}_monthly`,
                                            fill: activity.color,
                                            name: `${activityId} Monthly`,
                                            opacity: 0.6
                                        }),
                                        React.createElement(Line, {
                                            key: `line-${activityId}`,
                                            yAxisId: 'cumulative',
                                            type: 'monotone',
                                            dataKey: `${activityId}_cumulative`,
                                            stroke: activity.color,
                                            strokeWidth: 2,
                                            name: `${activityId} Cumulative`
                                        })
                                    ];
                                }).flat().filter(Boolean)
                            )
                        )
                    ),

                    // Instructions
                    React.createElement('div', { 
                        className: 'card',
                        style: { 
                            background: 'linear-gradient(45deg, #667eea, #764ba2)',
                            color: 'white'
                        }
                    },
                        React.createElement('h3', { className: 'text-2xl font-bold mb-4' },
                            'ðŸš€ Complete S-Curve Analysis Solution'),
                        React.createElement('div', { className: 'grid md:grid-cols-3 gap-6' },
                            React.createElement('div', null,
                                React.createElement('h4', { className: 'text-lg font-semibold mb-2' }, 'ðŸ”„ Interactive Analysis'),
                                React.createElement('ul', { className: 'space-y-1 text-sm' },
                                    React.createElement('li', null, 'â€¢ Upload your CSV/Excel files'),
                                    React.createElement('li', null, 'â€¢ Real-time chart updates'),
                                    React.createElement('li', null, 'â€¢ Interactive activity selection'),
                                    React.createElement('li', null, 'â€¢ Visual S-curve analysis'),
                                    React.createElement('li', null, 'â€¢ Print/PDF reports')
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h4', { className: 'text-lg font-semibold mb-2' }, 'ðŸ“Š Web-Based Solution'),
                                React.createElement('ul', { className: 'space-y-1 text-sm' },
                                    React.createElement('li', null, 'â€¢ No software installation needed'),
                                    React.createElement('li', null, 'â€¢ Works on any device'),
                                    React.createElement('li', null, 'â€¢ Instant file processing'),
                                    React.createElement('li', null, 'â€¢ Professional visualizations'),
                                    React.createElement('li', null, 'â€¢ Share-friendly reports')
                                )
                            ),
                            React.createElement('div', null,
                                React.createElement('h4', { className: 'text-lg font-semibold mb-2' }, 'ðŸ“‹ File Support'),
                                React.createElement('ul', { className: 'space-y-1 text-sm' },
                                    React.createElement('li', null, 'â€¢ CSV files (.csv)'),
                                    React.createElement('li', null, 'â€¢ Excel files (.xlsx, .xls)'),
                                    React.createElement('li', null, 'â€¢ Same column structure required'),
                                    React.createElement('li', null, 'â€¢ Activity ID, Name, then monthly data'),
                                    React.createElement('li', null, 'â€¢ Flexible time periods')
                                )
                            )
                        )
                    )
                )
            );
        };

        // Render the app
        ReactDOM.render(React.createElement(SCurveDashboard), document.getElementById('root'));
    </script>
</body>
</html>
